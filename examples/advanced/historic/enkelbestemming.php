<?php

/**
 * Copyright (c) 2019 Planviewer BV.
 *
 * For the full copyright and license information, please view
 * the LICENSE file that was distributed with this source code.
 *
 * @see https://github.com/Planviewer/api-client-php
 *
 *
 * Example create a new layer for a viewer
 *
 * @see https://docs.planviewer.nl/mapsapi/server_calls/layers.html#create-a-new-layer-for-a-viewer
 */

use Planviewer\Planviewer;

require dirname(__DIR__).'/../bootstrap.php';

/** $config is build up in bootstrap.php. take a look at the file to see how it's configured  */
$planviewer = new Planviewer($config);

/** As this a uniquely Dutch thing the following explaination will be in Dutch  */

/**
 *
 * In dit voorbeeld halen we alle enkelbestemmingen op uit een gebied (dossiergrens).
 * Deze bestemmingsplannen worden vervolgens met elkaar chronologisch versneden.
 * het resultaat is een kaart met alle nu geldende enkelbestemmingen in het gebied.
 *
 * LET OP! Deze functie kan vele calls doen om alle informatie te verwerken. Voer dit script en gelijkende scripts
 * uit in een apart process.
 *
 */


/** create a viewer */

/** mandatory */
$data = [
    'name' => 'my-enkelebestemmingen-viewer',
];

/** optional */
$options = [
    'default_show_print' => true,
    'default_show_reset' => true,
    'default_show_measure' => true,
    'default_show_snap' => true,
];

$viewer = $planviewer->mapsApi->createViewer($data, $options)->viewer;
$viewerId = $viewer->identifier;

/** https://docs.planviewer.nl/mapsapi/server_calls/viewers.html#set-the-outline-for-the-viewer */

/** @time of creation this geometry returned one enkelbestemming */
$options = [
  'type' => "Polygon",
  'coordinates' => '(193368.98099999999976717 447063.32900000002700835, 193360.00399999998626299 447064.17099999997299165, 193338.58799999998882413 447066.46199999999953434, 193313.70000000001164153 447069.17599999997764826, 193286.87899999998626299 447071.83399999997345731, 193258.58900000000721775 447074.6909999999916181, 193230.85899999999674037 447077.55400000000372529, 193203.05100000000675209 447080.47999999998137355, 193175.28299999999580905 447083.356000000028871, 193150.5689999999885913 447085.82099999999627471, 193116.76500000001396984 447086.49800000002142042, 193098.39400000000023283 447109.65200000000186265, 193082.91300000000046566 447124.7629999999771826, 193069.08900000000721775 447138.20500000001629815, 193057.95199999999022111 447149.08799999998882413, 193049.35099999999511056 447221.71799999999348074, 193161.49199999999837019 447210.84499999997206032, 193277.85899999999674037 447199.39500000001862645, 193386.28700000001117587 447188.79599999997299165, 193388.6279999999969732 447179.55699999997159466, 193418.54500000001280569 447064.3809999999939464, 193452.95499999998719431 447060.53399999998509884, 193480.95699999999487773 447057.40399999998044223, 193716.67499999998835847 447034.83000000001629815, 193844.72500000000582077 447020.50900000002002344, 193842.79600000000209548 447014.40799999999580905, 193834.70499999998719431 447015.20799999998416752, 193801.45300000000861473 447018.90299999999115244, 193759.34099999998579733 447023.29800000000977889, 193722.9340000000083819 447026.7629999999771826, 193693.0089999999909196 447030.0719999999855645, 193655.61300000001210719 447034.03600000002188608, 193623.78599999999278225 447037.12699999997857958, 193591.21700000000419095 447040.46899999998277053, 193558.98699999999371357 447043.66600000002654269, 193534.40200000000186265 447046.11999999999534339, 193505.52700000000186265 447049.25199999997857958, 193472.45499999998719431 447052.61300000001210719, 193444.6939999999885913 447055.4529999999795109, 193404.97500000000582077 447059.70799999998416752, 193380.62400000001071021 447062.2370000000228174, 193368.98099999999976717 447063.32900000002700835)',
];

/** @time of creation this geometry returned multiple enkelbestemmingen */
$options = [
    'type' => "Polygon",
    'coordinates' => '(190197.605 443310.289,190137.908 443291.721,190111.837 443259.695,190094.517 443238.838,190081.837 443221.252,190081.1336578 443222.13921699,190080.419481043 443223.017736083,190079.694577281 443223.887424977,190078.959055683 443224.748152702,190078.213027015 443225.599789634,190077.456603626 443226.442207519,190076.689899431 443227.275279494,190075.913029893 443228.0988801,190075.126112006 443228.912885306,190074.621 443229.425,190113.217 443276.917,190120.765 443286.214,190126.564 443293.045,190141.678 443310.757,190138.007 443314.015,190198.773 443382.487,190204.071 443389.536,190207.144 443393.837,190218.263 443409.997,190220.025 443412.464,190222.586 443416.422,190223.059 443417.152,190224.515 443419.786,190225.133 443421.158,190226.155 443424,190226.544 443425.459,190226.834 443426.941,190227.058 443428.705,190227.17 443430.479,190227.169 443432.257,190227.057 443434.031,190226.802 443435.638,190213.881 443451.464,190205.347 443438.987,190199.022 443443.469,190193.496 443435.712,190189.904 443430.667,190173.833 443408.149,190169.36 443400.081,190165.223 443392.376,190163.972 443389.829,190162.087 443386.379,190159.444 443381.54,190152.149 443369.156,190151.102 443367.688,190149.694 443365.706,190107.546 443303.795,190100.64 443293.521,190090.475 443278.401,190079.745 443262.134,190073.825 443252.929,190064.471 443238.252,190063.542925677 443238.937746077,190062.606506076 443239.612051619,190061.661882221 443240.274815078,190060.709196366 443240.925936645,190060.084 443241.344,190062.504 443245.231,190071.354 443259.024,190077.101 443267.453,190096.426 443296.364,190097.208 443297.533,190108.076 443313.371,190112.238 443319.718,190140.992 443361.876,190142.908 443364.506,190145.6 443368.575,190146.726 443370.276,190148.183 443372.478,190152.746 443380.114,190155.385 443384.726,190159.808 443392.898,190182.95 443434.451,190178.727 443428.105,190172.401 443418.54,190164.423 443406.395,190151.218 443386.953,190138.013 443367.51,190134.037 443362.02,190130.06 443356.531,190127.777 443353.284,190125.495 443350.036,190119.308 443341.674,190113.121 443333.312,190110.338 443329.383,190107.908 443326.285,190105.478 443323.186,190102.148 443318.715,190098.818 443314.245,190098.1 443313.053,190097.84 443312.157,190097.822 443311.734,190097.941 443310.889,190096.761 443309.526,190096.009 443309.444,190095.457 443309.264,190094.735 443308.615,190093.369 443306.678,190092.003 443304.74,190091.288 443303.788,190090.573 443302.836,190089.825 443301.84,190089.077 443300.843,190086.789 443297.651,190084.501 443294.459,190080.811 443289.194,190077.121 443283.929,190073.398 443278.427,190064.592 443265.631,190048.312 443240.95,190032.032 443216.269,190023.287 443202.332,190014.541 443188.395,190007.271 443176.451,190000 443164.507,189991.766 443150.316,189983.533 443136.125,189973.067 443117.359,189962.601 443098.592,189952.137 443078.839,189942.908 443059.84,189942.562 443059.174,189942.217 443058.507,189941.423 443056.976,189940.629 443055.445,189940.398 443055,189940.017 443054.266,189939.636 443053.531,189936.944 443048.339,189935.033 443044.649,189966.712 443030.386,189967.992977158 443029.819572444,189968.091 443029.777,189985.079 443072.293,189993.929 443068.016,189977.226 443026.333,190070.439 442994.706,190073.351318294 442993.737840484,190076.275298103 442992.805492494,190079.210499085 442991.909096439,190082.156479211 442991.048787312,190085.112794826 442990.224694672,190088.07900072 442989.436942625,190091.054650194 442988.685649804,190094.039295126 442987.97092935,190097.032486039 442987.292888898,190100.033772169 442986.651630557,190103.042701534 442986.047250901,190106.058821001 442985.479840944,190109.081676352 442984.949486138,190112.110812357 442984.456266352,190114.651 442984.072,190198.566 442971.821,190243.765 442964.459,190265.765 442961.214,190299.582 442957.363,190334.743 442954.091,190349.434 442952.272,190457.256 442942.509,190535.445 442941.113,190537.634 442941.342,190537.633 442941.342,190539.822 442941.572,190542.011 442941.801,190544.2 442942.03,190549.519 442942.819,190554.838 442943.608,190565.475 442945.187,190573.415 442946.256,190581.355 442947.325,190586.506 442947.706,190591.658 442948.086,190601.962 442948.846,190608.426 442948.999,190614.889 442949.152,190628.682 442949.712,190642.476 442950.272,190655.302 442950.934,190668.128 442951.596,190675.406 442951.545,190697.241 442951.392,190709.66 442950.883,190722.079 442950.374,190748.109 442948.663,190774.139 442946.951,190812.869 442944.11,190851.6 442941.27,190857.475 442940.805,190863.35 442940.339,190865.328 442940.237,190865.328 442940.238,190867.306 442940.136,190871.261 442939.932,190873.908 442940.164,190876.555 442940.397,190880.074 442941.037,190883.593 442941.677,190887.054 442941.939,190888.784 442942.07,190890.515 442942.201,190900.462 442942.027,190910.408 442941.852,190913.433 442941.503,190915.062 442941.124,190916.691 442940.746,190918.611 442939.874,190920.53 442939.001,190922.911 442937.709,190930.724 442932.855,190938.537 442928.001,190943.491 442936.45,190952.178 442951.267,190960.865 442966.084,190961.918 442967.889,190962.634 442969.117,190962.572 442969.305,190962.512 442969.466,190962.432 442969.837,190962.43 442970.254,190962.452 442970.476,190962.473 442970.697,190962.525 442970.886,190962.578 442971.076,190962.647 442971.24,190962.715 442971.405,190962.804 442971.578,190962.894 442971.751,190963.019 442971.961,190961.006 442973.182,190958.798 442974.523,190958.682 442974.584,190958.565 442974.644,190958.28 442974.86,190958.115 442975.05,190957.95 442975.239,190957.722 442975.63,190957.564 442976.01,190957.493 442976.497,190957.451 442976.963,190957.509 442977.507,190957.611 442977.941,190957.862 442978.403,190958.101 442978.812,190958.418 442979.13,190958.943 442979.516,190959.333 442979.707,190959.746 442979.838,190960.159 442979.924,190960.671 442979.897,190961.393 442979.778,190961.62 442979.664,190961.855 442979.512,190963.618 442978.456,190965.381 442977.401,190966.822 442976.612,190967.2 442977.262,190967.578 442977.912,190967.923 442978.185,190973.624 442987.959,190983.578 443004.807,190981.874 443005.99,190981.195 443006.55,190981.008 443006.704,190980.534 443007.317,190979.864 443008.79,190979.462 443009.283,190977.392 443010.617,190976.29 443011.724,190974.27 443012.537,190970.14 443015.739,190968.82 443017.052,190967.07 443019.321,190966.754 443019.847,190966.108 443021.43,190965.528 443022.355,190963.552 443024.448,190962.508 443025.895,190961.696 443027.305,190961.056 443028.089,190960.426 443028.725,190959.126 443029.821,190959.06 443030.116,190959.13 443031.454,190959.066 443031.589,190958.852 443031.618,190958.676 443031.454,190958.442 443030.886,190958.184 443030.727,190957.786 443030.874,190955.968 443032.316,190953.616 443034.549,190950.942 443036.805,190945.768 443041.025,190941.66 443044.564,190939.11 443046.972,190938.092 443047.049,190936.338 443048,190935.47 443048.241,190933.034 443049.308,190931.794 443050.195,190925.78 443054.191,190922.43 443056.422,190917.748 443059.09,190912.084 443061.935,190909.582 443063.05,190902.99 443065.695,190900.502 443066.816,190897.32 443068.731,190892.384 443072.253,190891.842 443072.791,190890.576 443074.556,190889.866 443075.266,190884.82 443078.777,190883.352 443079.684,190881.142 443081.538,190880.778 443081.618,190880.53 443081.573,190880.344 443081.39,190880.012 443080.794,190879.806 443080.609,190879.518 443080.585,190871.076 443085.222,190867.866 443086.7,190866.08 443087.723,190864.726 443088.955,190862.18 443090.569,190861.226 443091.438,190860.462 443091.812,190859.562 443092.11,190859.044 443092.455,190858.404 443093.05,190857.962 443093.324,190856.396 443093.92,190854.088 443094.47,190853.718 443094.372,190853.096 443094.054,190851.15 443094.28,190849.73 443094.635,190849.146 443094.628,190848.17 443094.335,190847.248 443094.302,190846.302 443094.479,190837.606 443098.649,190837.074 443099.046,190836.946 443099.244,190836.878 443099.829,190837.038 443100.217,190837.278 443100.334,190840.758 443100.068,190841.132 443100.294,190841.228 443100.608,190841.122 443101.146,190840.486 443101.811,190839.334 443102.426,190838.062 443103.26,190836.924 443104.252,190836.594 443104.78,190836.276 443106.149,190835.936 443106.677,190835.254 443107.255,190834.728 443107.543,190830.362 443108.902,190828.134 443109.752,190825.904 443110.84,190823.442 443112.141,190819.83 443113.889,190818.916 443114.436,190817.506 443115.447,190816.57 443116.271,190814.124 443118.692,190813.848 443119.082,190813.688 443119.602,190813.564 443120.593,190813.412 443120.939,190812.984 443121.377,190812.48 443121.535,190810.904 443121.234,190810.152 443121.502,190809.606 443121.828,190808.57 443122.699,190807.528 443124.267,190806.816 443124.911,190805.446 443125.932,190804.466 443126.354,190802.208 443127.011,190799.89 443127.389,190799.274 443127.555,190794.062 443129.735,190793.044 443130.236,190791.96 443130.952,190791.36 443131.474,190791.062 443131.926,190790.844 443133.279,190790.196 443134.735,190789.858 443135.339,190789.254 443135.917,190788.678 443136.074,190787.866 443136.035,190787.096 443136.14,190786.536 443136.342,190785.702 443136.996,190784.48 443138.307,190784.196 443138.26,190782.612 443137.441,190781.896 443137.606,190781.736 443137.864,190781.528 443139.504,190781.252 443139.932,190780.774 443140.215,190779.284 443140.032,190778.622 443140.024,190777.998 443140.24,190777.452 443140.699,190776.982 443140.97,190776.01 443141.093,190772.138 443141.03,190769.09 443141.414,190767.222 443141.559,190765.99 443141.855,190765.542 443142.082,190763.578 443142.764,190762.158 443143.013,190761.442 443142.974,190760.752 443142.792,190758.276 443141.705,190757.024 443140.462,190756.002 443139.495,190754.144 443138.044,190753.536 443137.511,190752.992 443136.869,190752.726 443136.304,190752.63 443135.31,190752.304 443133.907,190751.91 443133.146,190751.352 443132.321,190750.332 443131.133,190749.746 443130.721,190748.978 443130.38,190747.266 443130.099,190741.394 443130.777,190736.04 443131.514,190731.018 443132.615,190729.024 443133.359,190728.56 443133.716,190728.262 443134.063,190727.388 443136.225,190726.43 443137.191,190725.306 443137.958,190723.94 443139.029,190723.496 443139.532,190722.326 443141.288,190721.092 443142.631,190719.818 443144.282,190717.766 443145.759,190715.628 443146.72,190712.998 443147.613,190712.502 443148.252,190711.918 443150.478,190711.542 443151.165,190711.062 443151.7,190710.356 443152.228,190708.522 443153.184,190706.69 443154.299,190704.936 443155.046,190704.07 443155.52,190703.17 443156.363,190701.452 443157.449,190700.722 443158.081,190699.738 443159.477,190698.8 443160.283,190696.788 443161.625,190694.772 443163.602,190692.646 443165.938,190691.588 443166.864,190689.712 443167.96,190688.614 443168.785,190687.656 443169.809,190683.174 443173.561,190678.512 443177.335,190676.098 443179.017,190675.62 443179.43,190675.292 443179.995,190675.092 443180.64,190674.974 443184.023,190674.782 443185.063,190674.598 443185.507,190674.28 443185.865,190673.522 443186.227,190672.58 443186.371,190670.856 443186.321,190670.532 443185.967,190670.488 443185.549,190670.864 443184.559,190670.896 443184.009,190670.64 443183.111,190669.99 443181.943,190669.128 443180.098,190668.672 443179.444,190668.07 443178.94,190666.492 443178.311,190664.582 443176.995,190664.182 443176.456,190663.996 443175.917,190663.344 443174.585,190663.282 443174.148,190663.604 443173.221,190663.55 443172.732,190662.658 443170.911,190661.7 443169.523,190661.414 443168.978,190661.1 443168.341,190660.488 443167.758,190657.508 443166.834,190656.778 443166.437,190656.066 443165.913,190653.06 443161.298,190652.29 443160.775,190651.49 443160.407,190650.548 443160.588,190648.126 443161.323,190646.054 443161.825,190642.612 443162.512,190639.81 443163.24,190638.254 443163.956,190636.874 443164.714,190634.714 443166.204,190633.072 443167.438,190632.452 443168.003,190630.952 443170.923,190630.37 443171.475,190629.85 443171.609,190629.016 443171.683,190627.676 443171.622,190624.536 443172.32,190621.122 443172.955,190615.442 443174.468,190613.486 443175.225,190612.678 443175.711,190611.91 443176.334,190611.352 443176.986,190610.894 443177.839,190610.65 443179.004,190610.538 443180.309,190610.548 443181.365,190610.652 443182.934,190611.54 443187.878,190611.754 443189.51,190611.882 443191.535,190611.468 443192.495,190610.036 443194.116,190608.294 443195.672,190607.27 443196.725,190604.674 443199.787,190603.568 443200.594,190602.864 443200.957,190601.106 443201.564,190600.23 443201.98,190599.116 443202.898,190598.818 443203.439,190598.658 443204.322,190598.558 443205.887,190598.246 443207.069,190597.292 443208.629,190596.31 443209.605,190593.478 443211.933,190592.78 443212.483,190591.756 443213.577,190590.518 443214.686,190589.482 443215.894,190588.966 443217.007,190588.48 443217.447,190586.484 443218.153,190585.912 443218.431,190584.462 443218.639,190583.762 443218.634,190582.98 443218.938,190582.718 443219.203,190582.626 443219.746,190582.822 443220.536,190584.04 443222.446,190584.138 443222.89,190584.314 443228.256,190584.7 443231.277,190584.722 443232.301,190584.89 443233.18,190586.274 443236.662,190586.758 443236.737,190587.124 443236.928,190587.08 443237.194,190586.398 443237.791,190586.24 443238.333,190586.234 443238.892,190586.776 443239.358,190587.222 443239.53,190587.682 443239.537,190588 443239.523,190588.614 443239.087,190589.192 443239.29,190589.822 443240.083,190590.034 443240.473,190589.54 443240.706,190588.676 443240.79,190588.136 443241.156,190587.846 443242.325,190587.45 443243.018,190586.994 443243.441,190584.916 443244.907,190583.026 443247.06,190582.496 443247.531,190581.216 443248.305,190580.356 443248.55,190578.448 443248.813,190577.488 443249.112,190571.53 443251.938,190569.71 443252.574,190567.872 443253.55,190566.884 443253.891,190564.876 443254.277,190560.198 443254.764,190559.222 443254.778,190558.844 443254.691,190558.378 443254.45,190554.546 443251.463,190551.296 443247.604,190550.182 443245.283,190549.804 443243.913,190549.418 443241.975,190549.354 443240.032,190549.456 443239.388,190549.878 443237.924,190551.93 443233.395,190552.476 443231.266,190553.13 443229.796,190553.744 443228.808,190554.788 443227.811,190555.892 443226.987,190556.804 443226.146,190559.638 443222.575,190560.606 443221.422,190561.788 443220.395,190562.446 443219.644,190563.63 443217.982,190563.954 443217.638,190565.484 443216.651,190566.282 443216.028,190566.832 443215.464,190568.256 443212.768,190569.174 443209.652,190569.574 443205.298,190569.476 443204.138,190569.34 443203.65,190568.662 443202.678,190567.644 443201.613,190565.092 443199.606,190563.025 443197.461,190562.576 443196.995,190562.113 443196.85,190560.244 443196.974,190558.44 443196.72,190557.194 443196.303,190555.798 443195.711,190554.07 443194.863,190553.571 443194.399,190552.181 443192.603,190551.061 443191.444,190549.27 443189.282,190547.245 443187.571,190546.95 443178.941,190550.923 443178.988,190551.899 443178.905,190553.402 443178.339,190555.247 443178.154,190556.484 443177.586,190557.72 443177.153,190558.212 443176.877,190560.065 443176.17,190561.74 443175.294,190563.405 443174.667,190564.698 443173.881,190569.797 443170.371,190575.133 443167.475,190589.298 443161.322,190596.763 443158.401,190611.105 443151.492,190617.625 443148.525,190622.218 443146.702,190634.15 443141.4,190637.91 443140.185,190639.812 443139.16,190649.392 443132.032,190650.665 443130.713,190651.404 443129.418,190652.172 443127.297,190652.746 443125.141,190653.046 443122.17,190653.152 443118.371,190652.924 443115.269,190652.435 443111.971,190650.575 443101.98,190649.928 443097.457,190649.295 443092.017,190647.991 443085.65,190646.066 443078.057,190646.050564151 443077.997627799,190646.034400876 443077.93844949,190646.01751261 443077.879473985,190645.999901895 443077.820710167,190645.981571383 443077.762166883,190645.962523836 443077.703852951,190645.942762121 443077.645777153,190645.922289215 443077.587948235,190645.901108201 443077.530374905,190645.879222268 443077.473065834,190645.856634713 443077.416029652,190645.833348937 443077.359274949,190645.809368446 443077.302810272,190645.784696853 443077.246644124,190645.759337873 443077.190784963,190645.733295324 443077.135241203,190645.706573129 443077.080021206,190645.679175312 443077.025133291,190645.651105999 443076.970585721,190645.622369416 443076.916386713,190645.592969892 443076.862544427,190645.562911855 443076.809066974,190645.532199829 443076.755962405,190645.500838442 443076.703238719,190645.468832416 443076.650903855,190645.43618657 443076.598965696,190645.402905821 443076.547432061,190645.368995181 443076.496310714,190645.334459757 443076.445609351,190645.29930475 443076.395335609,190645.263535454 443076.345497058,190645.227157255 443076.296101204,190645.190175633 443076.247155486,190645.152596156 443076.198667276,190645.114424483 443076.150643874,190645.075666364 443076.103092513,190645.036327635 443076.056020355,190644.996414221 443076.009434488,190644.955932131 443075.963341927,190644.914887463 443075.917749615,190644.873286398 443075.872664417,190644.831135201 443075.828093123,190644.788440219 443075.784042446,190644.745207882 443075.740519018,190644.701444702 443075.697529394,190644.657157268 443075.65508005,190644.612352249 443075.613177376,190644.567036395 443075.571827685,190644.521216528 443075.531037202,190644.474899549 443075.490812071,190644.428092434 443075.451158349,190644.380802231 443075.412082008,190644.333036062 443075.373588933,190644.284801121 443075.335684922,190644.236104671 443075.298375681,190644.186954046 443075.26166683,190644.137356648 443075.225563896,190644.087319946 443075.190072318,190644.036851475 443075.155197439,190643.985958836 443075.120944512,190643.934649693 443075.087318696,190643.882931773 443075.054325053,190643.830812865 443075.021968553,190643.778300817 443074.990254069,190643.725403538 443074.959186376,190643.672128993 443074.928770154,190643.618485206 443074.899009982,190643.564480255 443074.869910344,190643.510122274 443074.84147562,190643.455419447 443074.813710093,190643.400380014 443074.786617945,190643.345012263 443074.760203256,190643.289324532 443074.734470002,190643.233325208 443074.709422061,190643.177022723 443074.685063204,190643.120425558 443074.661397098,190643.063542234 443074.63842731,190643.006381319 443074.616157296,190642.948951421 443074.594590412,190642.891261189 443074.573729905,190642.83331931 443074.553578916,190642.77513451 443074.534140481,190642.716715552 443074.515417527,190642.658071233 443074.497412873,190642.599210385 443074.480129231,190642.540141873 443074.463569203,190642.480874591 443074.447735283,190642.421417465 443074.432629857,190642.36177945 443074.418255198,190642.301969526 443074.404613472,190642.241996701 443074.391706733,190642.181870006 443074.379536925,190642.121598496 443074.36810588,190642.061191248 443074.35741532,190642.000657359 443074.347466855,190641.940005945 443074.338261983,190641.87924614 443074.32980209,190641.818387094 443074.32208845,190641.757437972 443074.315122225,190641.696407954 443074.308904465,190641.63530623 443074.303436104,190641.574142001 443074.298717968,190641.512924479 443074.294750766,190641.451662883 443074.291535096,190641.390366438 443074.289071442,190641.329044377 443074.287360175,190641.311 443074.287,190633.571 443074.102,190635.677 443030.607,190646.73 443031.138,190646.73 443031.136,190648.572 442993.091,190562.32 442989.882,190468.499 442986.391,190468.29 442992.009,190417.611 442990.124,190359.415 442987.959,190355.864 443083.409,190464.739 443087.46,190463.058 443120.08,190462.975 443155.074,190462.107 443175.41,190462.047205673 443176.635210291,190461.972380633 443177.859594558,190461.88253615 443179.082968413,190461.777685752 443180.305147619,190461.65784523 443181.525948123,190461.523032632 443182.745186074,190461.37326826 443183.962677862,190461.208574668 443185.178240135,190461.028976658 443186.391689835,190460.834501277 443187.60284422,190460.625177812 443188.811520896,190460.401037787 443190.017537839,190460.162114955 443191.220713429,190459.9084453 443192.420866472,190459.64006702 443193.617816228,190459.357020535 443194.811382441,190459.059348469 443196.001385366,190458.747095651 443197.187645791,190458.420309104 443198.369985071,190458.079038042 443199.548225149,190457.723333859 443200.722188587,190457.551 443201.273,190453.551 443213.935,190470.851 443214.685,190468.71 443231.914,190475.618 443232.879,190478.276 443211.389,190483.939 443156.692,190497.22 443157.268,190496.785 443167.287,190494.632 443171.202,190496.569 443181.063,190496.605 443185.121,190496.641 443189.179,190496.588 443199.772,190496.535 443210.365,190496.49 443219.366,190494.783 443228.928,190493.821 443230.699,190490 443234.741,190487.092 443237.11,190484.441 443239.314,190483.011 443239.743,190479 443242.141,190475.409 443243.04,190475 443243.252,190474.651 443243.543,190474.411 443243.84,190473.882 443245,190473.627 443246.267,190473.373 443247.535,190473.064 443248.064,190472.564 443248.556,190470 443249.864,190466.348 443255,190452.072 443267.3,190437.797 443279.6,190436.072 443281.564,190420.213 443292.07,190399.78 443305.434,190399.223 443307.324,190397.968 443310.812,190396.449 443315.741,190394.072 443320.86,190393.005 443323.653,190392.375 443324.465,190390.492 443325.922,190389.765 443327.093,190389.347 443328.081,190388.438 443329.769,190387.936 443330.426,190387.251 443330.941,190386.126 443331.425,190385.221 443331.591,190384.777 443331.432,190383.31 443330.521,190382.38 443329.237,190380.968 443326.927,190379.728 443325.143,190378.191 443322.394,190377.508 443321.474,190376.425 443320.886,190375.467 443320.645,190374.585 443320.537,190372.1 443320.707,190368.527 443321.095,190365.442 443321.65,190364.516 443322.206,190363.57 443322.649,190361.751 443323.891,190360.22 443325.202,190355.058 443329.304,190351.409 443331.935,190349.526 443333.556,190347.931 443334.666,190346.098 443335.663,190345.353 443335.917,190344.413 443335.937,190343.522 443335.603,190341.438 443334.279,190339.403 443332.499,190338.795 443331.528,190337.959 443329.137,190337.314 443327.807,190337.104 443326.947,190336.964 443325.267,190336.571 443323.7,190336.311 443321.47,190336.443 443318.699,190336.897 443315.734,190338.58 443311.875,190340.132 443307.328,190340.473 443306.658,190341.613 443305.224,190342.208 443304.131,190343.405 443303.292,190344.147 443302.369,190344.766 443301.392,190346.096 443299.803,190347.282 443298.221,190348.758 443296.634,190351.25 443294.319,190353.517 443292.651,190358.76 443288.471,190360.919 443286.843,190361.581 443286.426,190362.768 443285.424,190367.345 443282.248,190368.243 443281.577,190384.329 443301.558,190403.762 443285.205,190403.031 443284.06,190419.196 443270.279,190412.177 443262.043,190412.801 443261.42,190415.533 443258.276,190417.59 443255.32,190422.031 443245.143,190422.551 443232.263,190425.669 443169.063,190429.178 443169.155,190429.611 443153.278,190426.631 443153.313,190428.159 443114.336,190426.241 443110.577,190423.923 443106.321,190421.049 443107.762,190378.332 443124.296,190372.975 443127.347,190362.176 443134.823,190320.294 443137.465,190316.524 443143.938,190289.073 443193.052,190254.571 443253.129,190251.332 443258.183,190228.84 443245.966,190207.429 443284.621,190228.207 443296.131,190226.981 443298.38,190226.832530219 443298.648485732,190226.680776884 443298.915129295,190226.525762849 443299.179890534,190226.367511459 443299.442729576,190226.206046545 443299.703606838,190226.041392425 443299.962483034,190225.873573893 443300.219319178,190225.702616223 443300.474076591,190225.52854516 443300.726716908,190225.35138692 443300.977202082,190225.17116818 443301.22549439,190224.987916083 443301.471556441,190224.801658224 443301.71535118,190224.612422653 443301.95684189,190224.420237869 443302.195992205,190224.225132814 443302.43276611,190224.02713687 443302.667127946,190223.826279854 443302.899042421,190223.622592015 443303.128474609,190223.416104028 443303.355389957,190223.206846988 443303.579754295,190222.99485241 443303.801533832,190222.780152218 443304.02069517,190222.562778746 443304.237205304,190222.342764729 443304.451031628,190222.120143301 443304.662141941,190221.894947988 443304.87050445,190221.667212703 443305.076087778,190221.436971743 443305.278860962,190221.20425978 443305.478793468,190220.969111861 443305.675855186,190220.731563397 443305.870016438,190220.491650164 443306.061247985,190220.24940829 443306.249521029,190220.004874256 443306.434807215,190219.758084889 443306.617078641,190219.509077354 443306.796307857,190219.25788915 443306.972467872,190219.004558107 443307.145532157,190218.749122373 443307.315474648,190218.491620418 443307.482269754,190218.232091019 443307.645892356,190217.970573262 443307.806317812,190217.707106529 443307.963521963,190217.441730498 443308.117481135,190217.174485134 443308.268172142,190216.905410682 443308.41557229,190216.634547664 443308.559659383,190216.361936872 443308.700411719,190216.087619359 443308.837808104,190215.811636437 443308.971827845,190215.534029667 443309.102450759,190215.254840856 443309.229657176,190214.97411205 443309.353427938,190214.691885524 443309.473744406,190214.408203781 443309.590588461,190214.123109542 443309.703942506,190213.836645742 443309.813789472,190213.548855522 443309.920112814,190213.25978222 443310.022896522,190212.96946937 443310.122125116,190212.677960694 443310.217783653,190212.385300089 443310.309857728,190212.091531632 443310.398333473,190211.79669956 443310.483197566,190211.500848277 443310.564437226,190211.204022334 443310.642040218,190210.906266434 443310.715994855,190210.607625418 443310.786290002,190210.308144259 443310.85291507,190210.007868058 443310.915860027,190209.706842036 443310.975115394,190209.405111526 443311.030672246,190209.102721968 443311.082522218,190208.7997189 443311.1306575,190208.496147954 443311.175070844,190208.192054846 443311.215755562,190207.887485372 443311.252705525,190207.582485399 443311.285915171,190207.277100858 443311.315379497,190206.971377739 443311.341094066,190206.665362083 443311.363055006,190206.359099975 443311.38125901,190206.052637537 443311.395703335,190205.746020921 443311.406385808,190205.439296303 443311.413304818,190205.132509873 443311.416459325,190204.825707833 443311.415848853,190204.518936386 443311.411473494,190204.212241731 443311.403333906,190203.905670054 443311.391431317,190203.599267525 443311.375767517,190203.293080287 443311.356344867,190202.987154449 443311.33316629,190202.681536084 443311.306235279,190202.376271217 443311.275555888,190202.071405819 443311.241132737,190201.766985801 443311.202971011,190201.463057009 443311.161076456,190201.159665213 443311.115455383,190200.856856102 443311.06611466,190200.554675279 443311.013061719,190200.25316825 443310.95630455,190199.952380423 443310.895851699,190199.652357093 443310.83171227,190199.353143445 443310.763895924,190199.054784537 443310.692412872,190198.757325303 443310.61727388,190198.460810537 443310.538490264,190198.165284895 443310.456073887,190197.870792881 443310.370037162,190197.605 443310.289)',
];

/** set outline */
$planviewer->mapsApi->setViewerOutline($viewerId, $options);

/** Create an empty vector layer, we will be adding the geometries to this layer */
$data = [
    "name" => "Enkelbestemmingen",
    "type" => "vector",
    "base" => "false",
];
$options = [
    "consultable" => true,
    "vector_uploadable" => false,
    "vector_type" => "polygon", //always use polygon for enkelbestemmingen
    "vector_drawable" => true,
];
$vectorLayer = $planviewer->mapsApi->createLayer($viewerId, $data, $options)->layer;

/** gets the outline in correct format for the following gis calls */
$outlinedata = $planviewer->mapsApi->getViewerOutline($viewerId, 'txt');
/** Split between geometry and area */
list($srid, $outlineGeometry, $outlinearea) = explode(";", $outlinedata);


/** Now we need to shrink the outline slightly to make sure we don't create false positives later on  */
$options = [
    'geometry' => $outlineGeometry,
    'buffer' => -0.05, //units used is meters
];
$outlineShrunk = $planviewer->mapsApi->doBuffer($options);

$options = [
    'identifier' => $outlineShrunk->geometry
];

$enkelbestemmingen = $planviewer->dataApi->fetch('getenkelbestemmingbygeometry', $options);

/** Enkelbestemming must have one of these statuses */
$status = [
    'geconsolideerd',
    'vastgesteld',
    'onherroepelijk',
    'geconsolideerde versie',
];

//clean up the results
foreach ($enkelbestemmingen as $enkelbestemmingKey => $enkelbestemming) {
    $planGeleide = $planviewer->dataApi->fetch('getplangeleidestatusbyplanid', ['identifier' => $enkelbestemming->plan_id]);

    if (in_array($planGeleide[0]->status, $status)) {
        $enkelbestemmingen[$enkelbestemmingKey]->status = $planGeleide[0]->status;
        $enkelbestemmingen[$enkelbestemmingKey]->datum = $planGeleide[0]->datum;
    } else {
        unset($enkelbestemmingen[$enkelbestemmingKey]);
    }
}


$countedEb = count($enkelbestemmingen);
if (0 === $countedEb) {
    die('No Enkelbestemmingen found within the given geometry');
}
if (1 === $countedEb) {
    /** just one found, no need to do all the complicated stuff, just add this to the vector layer */
    $options = [
        'geometry' => $enkelbestemmingen[0]->geometry,
        'properties' => [
            'name' =>   $enkelbestemmingen[0]->naam,
            'groep' => $enkelbestemmingen[0]->bestemmingshoofdgroep,
        ],
    ];
    /** Add the properties to layer */
    $planviewer->mapsApi->setPropertyVectorLayer($viewerId, $vectorLayer->id, $options);
} else {
    /** you have found multiple enkelbestemmingen and it may be that they overlap. in which case we need to cut them up */
    array_walk($enkelbestemmingen, 'cookieCutter', ['targetArray' => $enkelbestemmingen, 'planviewer' => $planviewer]);
    var_dump($enkelbestemmingen);
}


function cookieCutter($a, $key, $b) {
    foreach ($b['targetArray'] as $tbKey => $tbval) {
        $b['planviewer']->mapsApi->doIntersection(['geom1' => $a->geometry, 'geom2' => $tbval->geometry]);
    }
}




//for creation only remove viewer after calls
//$planviewer->mapsApi->deleteViewer($viewerId);